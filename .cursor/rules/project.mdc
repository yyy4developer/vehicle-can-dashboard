---
alwaysApply: true
---

# Cursor Agent Rules

# Do's and Don'ts
- If the apx development servers are started and running, don't regenerate the OpenAPI client.
- Prefer running apx related commands via mcp server if it's available.
- Prefer to add new components via shadcn mcp server if it's available.
- When using the API calls on the frontend, use error boundaries to handle errors.
- Run apx dev check command (via CLI or via mcp) to check for errors in the project code after making changes.
- If agent has access to native browser tool, use it to verify changes on the frontend. If such tool is not present or is not working, use playwright mcp to automate browser actions (e.g. screenshots, clicks, etc.).
- Avoid unnecessary restarts of the development servers

## Package Management
- **Frontend:** Always use `bun` (never `npm`)
- **Python:** Always use `uv` (never `pip`)

## Component Management
- **Adding components:** When adding a new component via CLI command, always add `--yes` flag to skip confirmation
- **Component location:** If component was added to a wrong location (e.g. stored into `src/components` instead of `src/yao-demo-vehicle-app/ui/components`), move it to the proper folder
- **Component organization:** Prefer grouping components by functionality rather than by file type (e.g. `src/yao-demo-vehicle-app/ui/components/chat/`)

## Project Structure
Full-stack app: `src/yao-demo-vehicle-app/ui/` (React + Vite) and `src/yao-demo-vehicle-app/backend/` (FastAPI). Backend serves frontend at `/` and API at `/api`. API client auto-generated via `orval`.


## Models & API
- **3-model pattern:** `Entity` (DB), `EntityIn` (input), `EntityOut` (output)
- **API routes must have:** `response_model` and `operation_id` for client generation

## Frontend Rules
- **Routing:** `@tanstack/react-router` (routes in `src/yao-demo-vehicle-app/ui/routes/`)
- **Data fetching:** Always use `useXSuspense` hooks with `Suspense` and `Skeleton` components
- **Pattern:** Render static elements immediately, fetch API data with suspense
- **Components:** Use shadcn/ui, add to `src/yao-demo-vehicle-app/ui/components/`
- **Data access:** Use `selector()` function for clean destructuring (e.g., `const {data: profile} = useProfileSuspense(selector())`)

## Development Commands

**Start dev servers** (backend, frontend, OpenAPI watcher):
```bash
uv run apx dev start
```

**Check status** (shows running servers and ports):
```bash
uv run apx dev status
```

**View logs** (stored in `~/.apx/{app_id}/logs/`):
```bash
uv run apx dev logs              # All logs
uv run apx dev logs --ui         # Frontend only
uv run apx dev logs --backend    # Backend only
uv run apx dev tail              # Live stream
```

**Stop servers:**
```bash
uv run apx dev stop
```

**Build for production:**
```bash
uv run apx build
```

**OpenAPI generation** (auto-runs on each change with `dev start`):
```bash
uv run apx openapi               # Generate once
uv run apx openapi --watch       # Watch mode
```

**Note:** The OpenAPI watcher runs automatically with `dev start`. Manual generation is rarely needed.